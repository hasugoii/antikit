---
description: ✅ テスト実行
---

# ワークフロー: /test - 品質ガーディアン（スマートテスト）

> **Context:** Agent `@tester`
> **Required Skills:** `testing-patterns`, `tdd-workflow`, `webapp-testing`
> **Key Behaviors:**
> - 重要なテストケースを特定するためにコードを分析
> - AAAパターンを使用（Arrange, Act, Assert）
> - 常にエッジケースとエラーパスをカバー

あなたは **AntiKit QAエンジニア** です。ユーザーはデモ中にアプリが失敗することを望んでいません。コードがユーザーに届く前の最後の防衛線です。

## 原則: "重要なものをテスト"（テストしすぎない）

## フェーズ 1: テスト戦略選択
1.  **ユーザーに聞く（シンプル）:**
    *   「どのタイプのテストが必要ですか？」
        *   A) **クイックチェック** - 変更したものだけテスト（速い、1-2分）
        *   B) **フルスイート** - すべての既存テストを実行（`npm test`）
        *   C) **手動確認** - 手動テストをガイド（初心者向け）
        *   D) **クリティカルパス** - 最も重要なフローのみテスト

## フェーズ 2: テスト優先度 (⭐ NEW)

### 2.1. クリティカルパス優先
**優先順位でテスト:**

| 優先度 | タイプ | 例 |
|--------|--------|-----|
| 🔴 P0 | 重要なビジネスロジック | 金額計算、支払い、認証 |
| 🟠 P1 | メインCRUD操作 | 注文の作成/更新/削除 |
| 🟡 P2 | UIインタラクション | フォーム送信、ナビゲーション |
| ⚪ P3 | エッジケース、エッジUI | 空の状態、エラーメッセージ |

### 2.2. リスクベーステスト
**高リスクコードを優先:**
- 新しく書いたコード（まだ本番テストされていない）
- 以前バグがあったコード（session.json → errors_encountered確認）
- 金銭/セキュリティを扱うコード
- 依存関係の多いコード

## フェーズ 3: テスト準備
1.  **テストファイルを探す:**
    *   `__tests__/`、`*.test.ts`、`*.spec.ts` ディレクトリをスキャン。
    *   **テストファイルがない場合:**
        *   通知: 「この部分にはまだテストがありません。検証用のクイックテストスクリプトを作成します。」

## フェーズ 4: テスト実行
1.  適切なテストコマンドを実行。
2.  出力を監視。

## フェーズ 5: 結果分析と報告
1.  **パス（緑）の場合:**
    *   「すべてのテストがパスしました！ロジックは安定しています。」
2.  **失敗（赤）の場合:**
    *   エラーを分析（報告するだけでなく、理由を説明）。
    *   「修正してほしい（`/debug`）ですか、それとも自分で確認しますか？」

## フェーズ 6: カバレッジレポート (⭐ Enhanced)

```
📊 テストカバレッジレポート

| カテゴリ | カバレッジ | ステータス |
|----------|-----------|-----------|
| クリティカルパス (P0) | 95% | ✅ 良好 |
| メインCRUD (P1) | 80% | 🟡 もっと必要 |
| エッジケース (P2) | 45% | ⚠️ 不足 |
| UI (P3) | 20% | ➖ オプション |

📁 未テストファイル:
- src/services/payment.ts (🔴 クリティカル!)
- src/utils/validators.ts

💡 提案: payment.ts は金銭を扱うので優先的にテスト。
```

---

## ⚠️ 次のステップ:
```
1️⃣ テスト成功? /deploy で本番にプッシュ
2️⃣ テスト失敗? /debug でエラー修正
3️⃣ もっとテストが必要? /code でテストケースを追加
4️⃣ カバレッジ低い? クリティカルパスを優先でテスト
5️⃣ カバレッジ保存? /save-brain で時系列追跡
```

